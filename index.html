<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Genba Painting</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .sidebar { transition: all 0.3s; }
        .hidden-section { display: none !important; } /* Force hidden */
        /* Scanner Styles */
        #reader { width: 100%; border-radius: 10px; overflow: hidden; }
        .status-card { transition: transform 0.2s; }
        .status-card:hover { transform: translateY(-5px); }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="flex h-screen overflow-hidden text-slate-800">

    <aside id="sidebar-panel" class="sidebar w-64 bg-slate-900 text-white flex-col hidden md:hidden">
        <div class="p-6 border-b border-slate-700 flex items-center gap-3">
            <i class="fa-solid fa-paint-roller text-blue-400 text-2xl"></i>
            <div>
                <h1 class="font-bold text-lg">GENBA SYSTEM</h1>
                <p class="text-xs text-slate-400">Painting Dept.</p>
            </div>
        </div>
        
        <nav class="flex-1 p-4 space-y-2">
            <div id="menu-admin" class="hidden-section">
                <p class="text-xs font-bold text-slate-500 uppercase mb-2 px-2">Menu Admin</p>
                <button onclick="showSection('page-admin')" class="w-full text-left px-4 py-3 rounded hover:bg-slate-800 text-slate-300 hover:text-white transition">
                    <i class="fa-solid fa-qrcode w-6"></i> Manajemen QR
                </button>
            </div>

            <div id="menu-chief" class="hidden-section">
                <p class="text-xs font-bold text-slate-500 uppercase mb-2 px-2">Menu Chief</p>
                <button onclick="showSection('page-chief')" class="w-full text-left px-4 py-3 rounded hover:bg-slate-800 text-slate-300 hover:text-white transition">
                    <i class="fa-solid fa-camera w-6"></i> Scan Barcode
                </button>
            </div>

            <div id="menu-depthead" class="hidden-section">
                <p class="text-xs font-bold text-slate-500 uppercase mb-2 px-2">Menu Dept Head</p>
                <button onclick="showSection('page-depthead')" class="w-full text-left px-4 py-3 rounded hover:bg-slate-800 text-slate-300 hover:text-white transition">
                    <i class="fa-solid fa-chart-line w-6"></i> Dashboard
                </button>
            </div>

            <div class="mt-4 border-t border-slate-700 pt-4">
                <button onclick="logout()" class="w-full text-left px-4 py-3 rounded hover:bg-slate-800 text-red-400 font-semibold transition">
                    <i class="fa-solid fa-power-off w-6"></i> Logout
                </button>
            </div>
        </nav>

        <div class="p-4 border-t border-slate-700 bg-slate-950">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center font-bold shadow-lg" id="user-initial">U</div>
                <div>
                    <p class="text-sm font-semibold truncate w-32" id="sidebar-username">User</p>
                    <p class="text-xs text-green-400 uppercase tracking-wider" id="sidebar-role">Role</p>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-screen overflow-y-auto bg-slate-50 relative">
        
        <header id="mobile-header" class="bg-white shadow-sm p-4 md:hidden flex justify-between items-center hidden-section sticky top-0 z-50">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-paint-roller text-blue-600"></i>
                <h1 class="font-bold text-slate-800">GENBA PAINTING</h1>
            </div>
            <button onclick="logout()" class="text-red-500 bg-red-50 p-2 rounded-lg"><i class="fa-solid fa-power-off"></i></button>
        </header>

        <div class="p-4 md:p-8 max-w-7xl mx-auto w-full">
            
            <section id="page-login" class="min-h-[80vh] flex items-center justify-center">
                <div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-xl border border-slate-100">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600">
                            <i class="fa-solid fa-user-lock text-3xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-slate-800">Login Genba</h2>
                        <p class="text-slate-500 text-sm mt-1">Sistem Kontrol Line Painting</p>
                    </div>
                    
                    <form onsubmit="handleLogin(event)" class="space-y-5">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Username</label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-slate-400">
                                    <i class="fa-solid fa-user"></i>
                                </span>
                                <input type="text" id="username-input" class="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition" placeholder="Contoh: yanto / singgih" required autocomplete="off">
                            </div>
                            <p class="text-xs text-slate-400 mt-2 italic">*Masukkan username sesuai data karyawan.</p>
                        </div>
                        
                        <button type="submit" id="btn-login" class="w-full bg-blue-600 text-white py-3.5 rounded-lg font-bold hover:bg-blue-700 transition shadow-lg shadow-blue-500/30 flex justify-center items-center gap-2">
                            <span>MASUK SISTEM</span>
                            <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    </form>

                    <div class="mt-6 pt-6 border-t border-slate-100 text-center">
                        <p class="text-xs text-slate-400">Supported by GitHub & Supabase</p>
                    </div>
                </div>
            </section>

            <section id="page-chief" class="hidden-section max-w-lg mx-auto animate-fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mb-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-xl font-bold text-slate-800">ðŸ‘‹ Halo, Chief!</h2>
                            <p class="text-slate-500 text-sm">Siap melakukan patroli?</p>
                        </div>
                        <div class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-xs font-bold border border-blue-100" id="chief-shift-badge">
                            Loading Shift...
                        </div>
                    </div>
                    
                    <div class="p-4 bg-orange-50 rounded-xl border border-orange-100 flex items-center gap-3">
                        <i class="fa-solid fa-circle-info text-orange-500 text-xl"></i>
                        <p class="text-xs text-orange-800 leading-relaxed">
                            Pastikan barcode line terlihat jelas. Maksimal 3x scan per line dalam satu shift.
                        </p>
                    </div>
                </div>

                <div class="bg-slate-900 p-4 rounded-3xl shadow-2xl border-4 border-slate-800 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 z-10"></div>
                    <div id="reader" class="rounded-xl overflow-hidden bg-black min-h-[300px]"></div>
                    <p class="text-center text-slate-400 text-xs mt-4 flex items-center justify-center gap-2">
                        <i class="fa-solid fa-camera"></i> Kamera Aktif
                    </p>
                </div>

                <div class="mt-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-slate-700">Riwayat Scan Hari Ini</h3>
                        <span class="text-xs bg-slate-200 text-slate-600 px-2 py-1 rounded" id="scan-count">0 Data</span>
                    </div>
                    <ul id="chief-logs" class="space-y-3">
                        <li class="text-center text-slate-400 text-sm py-4">Belum ada scan hari ini.</li>
                    </ul>
                </div>
            </section>

            <section id="page-depthead" class="hidden-section animate-fade-in">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800 tracking-tight">Dashboard Monitoring</h2>
                        <p class="text-slate-500">Status Genba Real-time Area Painting</p>
                    </div>
                    <div class="flex items-center gap-4 bg-white p-2 rounded-lg shadow-sm border border-slate-200">
                        <div class="text-right px-2">
                            <div class="text-2xl font-bold text-slate-800 font-mono" id="clock">00:00</div>
                            <div class="text-xs font-bold text-blue-600 uppercase tracking-wide" id="monitor-shift">SHIFT -</div>
                        </div>
                        <div class="h-10 w-10 bg-blue-50 rounded flex items-center justify-center text-blue-600">
                            <i class="fa-regular fa-clock text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5" id="line-status-container">
                    <div class="col-span-full text-center py-10 text-slate-400">
                        <i class="fa-solid fa-circle-notch fa-spin text-2xl mb-2"></i>
                        <p>Memuat Data Line...</p>
                    </div>
                </div>

                <div class="mt-10 bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                            <i class="fa-solid fa-list-check text-blue-500"></i> Log Aktivitas Terbaru
                        </h3>
                        <button onclick="renderDashboard()" class="text-sm text-blue-600 hover:underline">
                            <i class="fa-solid fa-rotate"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="text-slate-400 text-xs uppercase tracking-wider border-b border-slate-100">
                                    <th class="p-4 font-semibold">Waktu</th>
                                    <th class="p-4 font-semibold">Chief</th>
                                    <th class="p-4 font-semibold">Lokasi</th>
                                    <th class="p-4 font-semibold">Shift</th>
                                    <th class="p-4 font-semibold text-right">Status</th>
                                </tr>
                            </thead>
                            <tbody id="all-logs-table" class="text-sm">
                                </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="page-admin" class="hidden-section animate-fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mb-8">
                    <h2 class="text-xl font-bold mb-4 text-slate-800 flex items-center gap-2">
                        <i class="fa-solid fa-print text-slate-600"></i> Manajemen QR Code
                    </h2>
                    <p class="text-slate-500 text-sm mb-6 bg-slate-50 p-3 rounded border border-slate-100">
                        Klik tombol <b>Print</b> untuk mencetak QR Code. Tempelkan QR Code pada titik lokasi Line Painting. Jika rusak/hilang, cetak ulang dari sini.
                    </p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6" id="admin-qr-container">
                        </div>
                </div>
            </section>

        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
        // --- KONFIGURASI SUPABASE ---
        // GANTI DENGAN DATA PROYEK ANDA DARI SUPABASE
        const SUPABASE_URL = 'https://fbfvhcwisvlyodwvmpqg.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZiZnZoY3dpc3ZseW9kd3ZtcHFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4MTQ2MzQsImV4cCI6MjA3MjM5MDYzNH0.mbn9B1xEr_8kmC2LOP5Jv5O7AEIK7Fa1gxrqJ91WNx4';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- STATE & VARIABEL ---
        let currentUser = null;
        let locations = [];
        let html5QrcodeScanner = null;
        let dashboardInterval = null;

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            setInterval(updateClock, 1000);
            updateClock();
        });

        // --- NAVIGASI ---
        function showSection(sectionId) {
            // Sembunyikan semua section
            document.querySelectorAll('main section').forEach(el => el.classList.add('hidden-section'));
            // Tampilkan section target
            document.getElementById(sectionId).classList.remove('hidden-section');
        }

        // --- LOGIN (KETIK NAMA) ---
        async function handleLogin(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-login');
            const input = document.getElementById('username-input');
            const username = input.value.trim().toLowerCase(); // Normalize input

            if (!username) return;

            // Loading state
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Checking...';
            btn.disabled = true;

            try {
                // Cek ke Database
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('username', username)
                    .single(); // Ambil satu data saja

                if (error || !data) {
                    throw new Error('User tidak ditemukan!');
                }

                // LOGIN SUKSES
                currentUser = data;
                setupUIForUser(currentUser);
                
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true
                });
                Toast.fire({
                    icon: 'success',
                    title: `Selamat Datang, ${currentUser.full_name}`
                });

            } catch (err) {
                Swal.fire({
                    icon: 'error',
                    title: 'Gagal Masuk',
                    text: 'Username tidak ditemukan di database. Coba: yanto, sarno, singgih, atau admin.',
                    confirmButtonColor: '#3b82f6'
                });
            } finally {
                btn.innerHTML = '<span>MASUK SISTEM</span><i class="fa-solid fa-arrow-right"></i>';
                btn.disabled = false;
            }
        }

        function setupUIForUser(user) {
            // Hide Login Page
            document.getElementById('page-login').classList.add('hidden-section');
            
            // Setup Sidebar & Header
            document.getElementById('sidebar-panel').classList.remove('md:hidden'); // Show sidebar desktop
            document.getElementById('sidebar-panel').classList.add('md:flex'); 
            document.getElementById('mobile-header').classList.remove('hidden-section'); // Show header mobile
            
            document.getElementById('sidebar-username').innerText = user.full_name;
            document.getElementById('sidebar-role').innerText = user.role.toUpperCase();
            document.getElementById('user-initial').innerText = user.full_name.charAt(0);

            // Routing Role
            if (user.role === 'chief') {
                document.getElementById('menu-chief').classList.remove('hidden-section');
                showSection('page-chief');
                initChiefMode();
            } else if (user.role === 'dept_head') {
                document.getElementById('menu-depthead').classList.remove('hidden-section');
                showSection('page-depthead');
                initDeptHeadMode();
            } else if (user.role === 'admin') {
                document.getElementById('menu-admin').classList.remove('hidden-section');
                showSection('page-admin');
                initAdminMode();
            }
        }

        function logout() {
            if (html5QrcodeScanner) {
                html5QrcodeScanner.clear();
            }
            if (dashboardInterval) {
                clearInterval(dashboardInterval);
            }
            location.reload();
        }

        // --- LOGIC WAKTU & SHIFT ---
        function getShift() {
            const now = new Date();
            const hour = now.getHours();
            // Shift 1: 07:00 - 15:00
            // Shift 2: 15:00 - 23:00
            // Shift 3: 23:00 - 07:00
            if (hour >= 8 && hour < 16) return 'SHIFT 1';
            if (hour >= 16 && hour < 24) return 'SHIFT 2';
            return 'SHIFT 3';
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'});
            const shift = getShift();

            if(document.getElementById('clock')) {
                document.getElementById('clock').innerText = timeString;
                document.getElementById('monitor-shift').innerText = shift;
            }
            if(document.getElementById('chief-shift-badge')) {
                document.getElementById('chief-shift-badge').innerText = shift;
            }
        }

        // --- MODE CHIEF (SCANNER) ---
        async function initChiefMode() {
            // Load Locations untuk validasi offline (cepat)
            const { data } = await supabase.from('locations').select('*');
            if(data) locations = data;

            loadChiefLogs();
            startScanner();
        }

        function startScanner() {
            html5QrcodeScanner = new Html5Qrcode("reader");
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            
            // Prefer back camera
            html5QrcodeScanner.start({ facingMode: "environment" }, config, onScanSuccess)
            .catch(err => {
                console.error("Camera error", err);
                Swal.fire("Kamera Error", "Pastikan izin kamera aktif.", "error");
            });
        }

        async function onScanSuccess(decodedText, decodedResult) {
            html5QrcodeScanner.pause(); // Pause camera

            // 1. Validasi Lokasi
            const matchedLocation = locations.find(loc => loc.code === decodedText);

            if (matchedLocation) {
                // 2. Simpan Data
                Swal.fire({
                    title: 'Memproses...',
                    text: `Menyimpan data ${matchedLocation.name}`,
                    didOpen: () => Swal.showLoading()
                });

                const { error } = await supabase.from('genba_logs').insert([{
                    user_name: currentUser.full_name,
                    location_id: matchedLocation.id,
                    shift: getShift()
                }]);

                if (!error) {
                    await Swal.fire({
                        icon: 'success',
                        title: 'BERHASIL!',
                        text: `Lokasi: ${matchedLocation.name} tercatat.`,
                        timer: 1500,
                        showConfirmButton: false
                    });
                    loadChiefLogs(); 
                } else {
                    Swal.fire('Gagal', 'Koneksi error, coba lagi.', 'error');
                }
            } else {
                await Swal.fire('QR Tidak Dikenal', 'Kode QR ini bukan milik Line Painting.', 'warning');
            }

            // Resume
            setTimeout(() => {
                html5QrcodeScanner.resume();
            }, 1000);
        }

        async function loadChiefLogs() {
            const today = new Date().toISOString().split('T')[0];
            const { data } = await supabase
                .from('genba_logs')
                .select('*, locations(name)')
                .gte('scan_time', today)
                .eq('user_name', currentUser.full_name)
                .order('scan_time', { ascending: false })
                .limit(5);

            const ul = document.getElementById('chief-logs');
            ul.innerHTML = '';
            
            if (data && data.length > 0) {
                document.getElementById('scan-count').innerText = `${data.length} Data`;
                data.forEach(log => {
                    const li = document.createElement('li');
                    li.className = 'bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center';
                    li.innerHTML = `
                        <div>
                            <p class="font-bold text-slate-800 text-sm">${log.locations.name}</p>
                            <p class="text-xs text-slate-400 mt-1"><i class="fa-solid fa-clock"></i> ${new Date(log.scan_time).toLocaleTimeString()}</p>
                        </div>
                        <i class="fa-solid fa-check-circle text-green-500 text-xl"></i>
                    `;
                    ul.appendChild(li);
                });
            } else {
                ul.innerHTML = '<li class="text-center text-slate-400 text-sm py-4">Belum ada scan hari ini.</li>';
            }
        }

        // --- MODE DEPT HEAD (MONITORING) ---
        async function initDeptHeadMode() {
            renderDashboard();
            dashboardInterval = setInterval(renderDashboard, 10000); // Auto refresh 10s
        }

        async function renderDashboard() {
            // 1. Ambil Data
            const { data: locs } = await supabase.from('locations').select('*').order('id');
            const shiftNow = getShift();
            const today = new Date().toISOString().split('T')[0];
            
            const { data: logs } = await supabase
                .from('genba_logs')
                .select('*')
                .eq('shift', shiftNow)
                .gte('scan_time', today);

            // 2. Render Kartu
            const container = document.getElementById('line-status-container');
            container.innerHTML = '';

            if(locs) {
                locs.forEach(loc => {
                    const scanData = logs.find(l => l.location_id === loc.id);
                    const isDone = !!scanData;

                    // Styles
                    const bgClass = isDone ? 'bg-gradient-to-br from-green-50 to-green-100 border-green-200' : 'bg-white border-slate-200 border-l-4 border-l-red-500';
                    const icon = isDone 
                        ? `<div class="h-10 w-10 rounded-full bg-green-500 text-white flex items-center justify-center shadow-lg shadow-green-500/30"><i class="fa-solid fa-check text-xl"></i></div>` 
                        : `<div class="h-10 w-10 rounded-full bg-slate-100 text-slate-300 flex items-center justify-center"><i class="fa-solid fa-xmark text-xl"></i></div>`;
                    
                    const statusText = isDone 
                        ? `<span class="text-green-700 font-bold text-xs bg-green-200 px-2 py-0.5 rounded">SUDAH</span>` 
                        : `<span class="text-red-600 font-bold text-xs bg-red-100 px-2 py-0.5 rounded">BELUM</span>`;

                    const detailText = isDone
                        ? `<div class="mt-3 text-xs text-slate-600 border-t border-green-200 pt-2 flex justify-between">
                             <span>${scanData.user_name}</span>
                             <span class="font-mono">${new Date(scanData.scan_time).toLocaleTimeString()}</span>
                           </div>`
                        : `<div class="mt-3 text-xs text-slate-400 border-t border-slate-100 pt-2">Menunggu scan...</div>`;

                    const html = `
                    <div class="status-card p-5 rounded-2xl shadow-sm border ${bgClass} relative overflow-hidden group">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-slate-800 text-sm w-3/4">${loc.name}</h4>
                            ${icon}
                        </div>
                        <div class="mb-1">${statusText}</div>
                        ${detailText}
                    </div>
                    `;
                    container.innerHTML += html;
                });
            }

            // 3. Render Tabel Bawah
             const { data: recentLogs } = await supabase
                .from('genba_logs')
                .select('*, locations(name)')
                .order('scan_time', { ascending: false })
                .limit(10);
            
            const tbody = document.getElementById('all-logs-table');
            tbody.innerHTML = '';
            if(recentLogs) {
                recentLogs.forEach(log => {
                    const tr = document.createElement('tr');
                    tr.className = "border-b border-slate-50 hover:bg-slate-50 transition";
                    tr.innerHTML = `
                        <td class="p-4 text-slate-500 font-mono text-xs">${new Date(log.scan_time).toLocaleString()}</td>
                        <td class="p-4 font-bold text-slate-700">${log.user_name}</td>
                        <td class="p-4 text-slate-600">${log.locations.name}</td>
                        <td class="p-4"><span class="bg-blue-50 text-blue-600 px-2 py-1 rounded text-xs font-bold">${log.shift}</span></td>
                        <td class="p-4 text-right"><i class="fa-solid fa-circle-check text-green-500"></i></td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        }

        // --- MODE ADMIN (QR) ---
        async function initAdminMode() {
            const { data: locs } = await supabase.from('locations').select('*').order('id');
            const container = document.getElementById('admin-qr-container');
            container.innerHTML = '';

            if(locs) {
                locs.forEach(loc => {
                    const div = document.createElement('div');
                    div.className = "bg-white border border-slate-200 p-5 rounded-xl shadow-sm flex flex-col items-center text-center hover:shadow-md transition";
                    div.innerHTML = `
                        <h4 class="font-bold text-sm text-slate-800 mb-3 h-10 flex items-center justify-center">${loc.name}</h4>
                        <div class="bg-white p-2 rounded border border-slate-100 mb-4">
                            <div id="qr-${loc.id}"></div>
                        </div>
                        <div class="flex gap-2 w-full">
                            <button onclick="printQR('qr-${loc.id}', '${loc.name}')" class="flex-1 bg-slate-800 text-white text-xs py-2 rounded-lg hover:bg-slate-900 transition font-semibold">
                                <i class="fa-solid fa-print mr-1"></i> Print
                            </button>
                        </div>
                    `;
                    container.appendChild(div);

                    new QRCode(div.querySelector(`#qr-${loc.id}`), {
                        text: loc.code,
                        width: 120,
                        height: 120,
                        colorDark : "#0f172a",
                        colorLight : "#ffffff",
                    });
                });
            }
        }

        function printQR(elementId, title) {
            const qrHtml = document.getElementById(elementId).innerHTML;
            const win = window.open('', '', 'height=600,width=600');
            win.document.write(`
                <html>
                <head>
                    <title>Print QR - ${title}</title>
                    <style>
                        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
                        .qr-box { border: 2px solid black; padding: 20px; text-align: center; border-radius: 10px; }
                        h1 { font-size: 24px; margin-bottom: 20px; }
                        p { margin-top: 10px; font-weight: bold; }
                    </style>
                </head>
                <body>
                    <div class="qr-box">
                        <h1>${title}</h1>
                        ${qrHtml}
                        <p>GENBA CHECKPOINT</p>
                    </div>
                </body>
                </html>
            `);
            win.document.close();
            win.focus();
            setTimeout(() => { win.print(); win.close(); }, 500);
        }

    </script>
</body>
</html>